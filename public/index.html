<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplayer Word Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background-color: #000; /* Optional: dark background color */
    }
    #game-container {
      height: 100%;
      width: 100%;
    }
  </style>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <script src="js/MenuScene.js"></script>
  <script src="js/WaitingScene.js"></script>
  <script src="js/CountdownScene.js"></script>
  <script src="js/GameScene.js"></script>
  <script src="js/utils.js"></script>
</head>
<body>
  <div id="game-container"></div>

  <script>
    const socket = io();
    window.socket = socket;
    
    const urlParams = new URLSearchParams(window.location.search);
    const roomIdFromUrl = urlParams.get('room');
    if (roomIdFromUrl) {
      window.socket.emit('joinRoom', roomIdFromUrl);
    }

    // Phaser game configuration
    const config = {
      type: Phaser.AUTO,
      scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH,
        width: 800,
        height: 800,
        parent: 'game-container'
      },
      scene: [MenuScene, WaitingScene, CountdownScene, GameScene],
      physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 0 },
            debug: false
        }
    }
    };

    const game = new Phaser.Game(config);
    window.addEventListener('resize', function() {
      game.scale.resize(window.innerWidth, window.innerHeight);
    });

    // Socket listeners
    window.socket.on('joinedRoom', (data) => {
      history.pushState({}, '', `?room=${data.roomId}`);
    });

    window.socket.on('connect', () => {
      console.log('Connected to server');
      const lastRoomId = localStorage.getItem('lastRoomId');
      if (lastRoomId) {
        socket.emit('reconnectToRoom', lastRoomId);
      }
    });

    window.socket.on('gameData', (data) => {
      console.log('Received game data with word:', data.givenWord);
      window.givenWord = data.givenWord;
    });

    window.socket.on('startGame', (data) => {
      console.log('Received startGame:', data.message);
      if (game.scene.isActive('WaitingScene')) {
        console.log('Stopping WaitingScene');
        game.scene.stop('WaitingScene');
      }
      console.log('Starting CountdownScene');
      game.scene.start('CountdownScene');
    });

    window.socket.on('gameRestarted', (data) => {
      console.log('Game restarted:', data.message);
      window.givenWord = data.givenWord;
      
      if (game.scene.isActive('GameScene')) {
        game.scene.stop('GameScene');
      }
      game.scene.start('CountdownScene');
    });
  </script>
</body>
</html>